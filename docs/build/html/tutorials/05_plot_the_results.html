<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>05_plot_the_results &mdash; pigeon_feather 0.9 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=049aceee"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="04_check_the_fitting" href="04_check_the_fitting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pigeon_feather
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="00_ecdhfr_showcase.html">00_Showcase ecDHFR: a FEATHER walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_load_data.html">01_load_data</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_peptide_level_analysis.html">02_peptide_level_analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_calculate_PFs.html">03_calculate_PFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_check_the_fitting.html">04_check_the_fitting</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">05_plot_the_results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#barplot-of-the-kex">barplot of the kex</a></li>
<li class="toctree-l3"><a class="reference internal" href="#delta-log(PF)s">delta log(PF)s</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pigeon_feather</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorial.html">Tutorials</a></li>
      <li class="breadcrumb-item active">05_plot_the_results</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/05_plot_the_results.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="05_plot_the_results">
<h1>05_plot_the_results<a class="headerlink" href="#05_plot_the_results" title="Link to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pigeon_feather.data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pigeon_feather.plot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pigeon_feather.hxio</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pigeon_feather.spectra</span> <span class="kn">import</span> <span class="o">*</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">datetime</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Determination of memory status is not supported on this
 platform, measuring for memoryleaks will never fail
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the pickle file we saved in the previous notebook</span>


<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">today</span> <span class="o">=</span> <span class="s2">&quot;20240722&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data/hdxms_data_raw_</span><span class="si">{</span><span class="n">today</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">hdxms_data_list</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


<span class="c1"># back exchange correction for peptides with experimental full deuteration data based its closest match in the database</span>
<span class="n">tools</span><span class="o">.</span><span class="n">backexchange_correction</span><span class="p">(</span><span class="n">hdxms_data_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of peptides with experimental max_d: 358
Number of peptides with no experimental max_d: 12
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make folders for results</span>

<span class="n">today_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># today_date = &#39;20240722&#39;</span>
<span class="n">results_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ecDHFR_results_</span><span class="si">{</span><span class="n">today_date</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_path</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">results_path</span><span class="p">)</span>


<span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;./data/PF_input_20240722&quot;</span>
</pre></div>
</div>
</div>
<p>Create an <code class="docutils literal notranslate"><span class="pre">Analysis</span></code> object and load the results. <strong>Note:</strong> The temperature and pH are crucial for calculating the intrinsic exchange rates, so make sure to input the correct values. The chunk size and chunk number can be altered by the user. In this tutorial, they were automatically determined by a helper function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pigeon_feather.analysis</span> <span class="kn">import</span> <span class="n">Analysis</span><span class="p">,</span> <span class="n">get_index_offset</span>
<span class="kn">from</span> <span class="nn">pigeon_feather.tools</span> <span class="kn">import</span> <span class="n">optimal_chunks</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">RUN_NUM</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">apo_states</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">state</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">hdxms_data_list</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">states</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">state_name</span> <span class="o">==</span> <span class="s2">&quot;APO&quot;</span>
<span class="p">]</span>

<span class="n">tri_states</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">state</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">hdxms_data_list</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">states</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">state_name</span> <span class="o">==</span> <span class="s2">&quot;TRI&quot;</span>
<span class="p">]</span>

<span class="n">ana_apo_1</span> <span class="o">=</span> <span class="n">Analysis</span><span class="p">(</span><span class="n">apo_states</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">293.0</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="mf">7.0</span><span class="p">)</span>

<span class="n">chunk_num</span><span class="p">,</span> <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">optimal_chunks</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ana_apo_1</span><span class="o">.</span><span class="n">protein_sequence</span><span class="p">))</span>
<span class="n">ana_apo_1</span><span class="o">.</span><span class="n">load_bayesian_hdx_oupt_chunks</span><span class="p">(</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
    <span class="n">chunk_num</span><span class="o">=</span><span class="n">chunk_num</span><span class="p">,</span>
    <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;APO&quot;</span><span class="p">,</span>
    <span class="n">run_num</span><span class="o">=</span><span class="n">RUN_NUM</span><span class="p">,</span>
    <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">bayesian_hdx_data_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">/bayesian_hdx_output_chunks&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">ana_tri_1</span> <span class="o">=</span> <span class="n">Analysis</span><span class="p">(</span><span class="n">tri_states</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">293.0</span><span class="p">,</span> <span class="n">pH</span><span class="o">=</span><span class="mf">7.0</span><span class="p">)</span>

<span class="n">ana_tri_1</span><span class="o">.</span><span class="n">load_bayesian_hdx_oupt_chunks</span><span class="p">(</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
    <span class="n">chunk_num</span><span class="o">=</span><span class="n">chunk_num</span><span class="p">,</span>
    <span class="n">state_name</span><span class="o">=</span><span class="s2">&quot;TRI&quot;</span><span class="p">,</span>
    <span class="n">run_num</span><span class="o">=</span><span class="n">RUN_NUM</span><span class="p">,</span>
    <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">bayesian_hdx_data_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">/bayesian_hdx_output_chunks&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<section id="barplot-of-the-kex">
<h2>barplot of the kex<a class="headerlink" href="#barplot-of-the-kex" title="Link to this heading"></a></h2>
<p>barplot showing the FEATHER derived exchange rates. index_offset is determined by comparison to the sequence in HX/MS and the pdb file provided.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># APO state only</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ana_apo_1</span><span class="o">.</span><span class="n">plot_kex_bar</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution_indicator_pos</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;APO&quot;</span><span class="p">,</span> <span class="n">show_seq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span>
<span class="p">)</span>

<span class="n">ana_tri_1</span><span class="o">.</span><span class="n">plot_kex_bar</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">resolution_indicator_pos</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TRI&quot;</span><span class="p">,</span> <span class="n">show_seq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">step</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FuncFormatter</span><span class="p">,</span> <span class="n">MultipleLocator</span>

<span class="kn">from</span> <span class="nn">pigeon_feather.analysis</span> <span class="kn">import</span> <span class="n">get_index_offset</span>

<span class="n">pdb_file</span> <span class="o">=</span> <span class="s2">&quot;./data/6XG5_TRI.pdb&quot;</span>
<span class="n">index_offset</span> <span class="o">=</span> <span class="n">get_index_offset</span><span class="p">(</span><span class="n">ana_apo_1</span><span class="p">,</span> <span class="n">pdb_file</span><span class="p">)</span>

<span class="c1"># # ax.xaxis.set_major_locator(plt.MultipleLocator(2))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[::</span><span class="mi">2</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>


<span class="k">def</span> <span class="nf">format_func</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">tick_number</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">index_offset</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">format_func</span><span class="p">))</span>

<span class="n">seq_pos</span> <span class="o">=</span> <span class="mi">17</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ana_apo_1</span><span class="o">.</span><span class="n">protein_sequence</span><span class="p">[:]),</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">ii</span><span class="p">,</span>
        <span class="n">seq_pos</span><span class="p">,</span>
        <span class="n">ana_apo_1</span><span class="o">.</span><span class="n">protein_sequence</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;-log(k$_</span><span class="si">{ex}</span><span class="s2">$)&quot;</span><span class="p">)</span>
    <span class="c1">#ax.legend(loc=&quot;lower left&quot;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ana_apo_1</span><span class="o">.</span><span class="n">protein_sequence</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ana_apo_1</span><span class="o">.</span><span class="n">protein_sequence</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">/ecDHFR_kex_bar_APO_TRI_</span><span class="si">{</span><span class="n">today_date</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_05_plot_the_results_8_0.png" src="../_images/tutorials_05_plot_the_results_8_0.png" />
</div>
</div>
<p>logP projection to a pdb structure</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pigeon_feather.analysis</span> <span class="kn">import</span> <span class="n">BFactorPlot</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bfactor_plot</span> <span class="o">=</span> <span class="n">BFactorPlot</span><span class="p">(</span>
    <span class="n">ana_apo_1</span><span class="p">,</span>
    <span class="n">pdb_file</span><span class="o">=</span><span class="s2">&quot;./data/6XG5_TRI.pdb&quot;</span><span class="p">,</span>
    <span class="n">plot_deltaG</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">293.15</span><span class="p">,</span>
    <span class="n">logP_threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">bfactor_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">/6XG5_APO_deltaG.pdb&quot;</span><span class="p">)</span>

<span class="c1"># bfactor_plot = BFactorPlot(</span>
<span class="c1">#     ana_apo_1,</span>
<span class="c1">#     pdb_file=&quot;./data/6XG5_APO_relaxed_best_solvated.pdb&quot;,</span>
<span class="c1">#     plot_deltaG=True,</span>
<span class="c1">#     temperature=293.15,</span>
<span class="c1"># )</span>
<span class="c1"># bfactor_plot.plot(f&quot;{out_path}/6XG5_APO_deltaG.pdb&quot;)</span>
</pre></div>
</div>
</div>
</section>
<section id="delta-log(PF)s">
<h2>delta log(PF)s<a class="headerlink" href="#delta-log(PF)s" title="Link to this heading"></a></h2>
<p>if there are mutiple states availble, you can map the difference to the pdb strutcure</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bfactor_plot</span> <span class="o">=</span> <span class="n">BFactorPlot</span><span class="p">(</span>
    <span class="n">ana_apo_1</span><span class="p">,</span>
    <span class="n">ana_tri_1</span><span class="p">,</span>
    <span class="n">pdb_file</span><span class="o">=</span><span class="s2">&quot;./data/6XG5_TRI.pdb&quot;</span><span class="p">,</span>
    <span class="n">plot_deltaG</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">293.15</span><span class="p">,</span>
    <span class="n">logP_threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">bfactor_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">/6XG5_deltaG_APO-TRI.pdb&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can visualize the results in PyMOL by running the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spectrum<span class="w"> </span>b,<span class="w"> </span>green_white_magenta,<span class="w"> </span><span class="nv">minimum</span><span class="o">=</span>-20,<span class="w"> </span><span class="nv">maximum</span><span class="o">=</span><span class="m">20</span><span class="p">;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span>nans,<span class="w"> </span>not<span class="w"> </span><span class="o">(</span><span class="nv">b</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>or<span class="w"> </span>b&gt;0<span class="w"> </span>or<span class="w"> </span>b&lt;<span class="m">0</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>color<span class="w"> </span>grey20,<span class="w"> </span>nans<span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nans</span></code> are Prolines and residues with no coverage.</p>
<p>export logPFs to a csv</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">MDAnalysis</span>
<span class="kn">from</span> <span class="nn">pigeon_feather.analysis</span> <span class="kn">import</span> <span class="n">get_res_avg_logP</span><span class="p">,</span> <span class="n">get_res_avg_logP_std</span>

<span class="n">pdb_file</span> <span class="o">=</span> <span class="s2">&quot;./data/6XG5_TRI.pdb&quot;</span>
<span class="n">index_offset</span> <span class="o">=</span> <span class="n">get_index_offset</span><span class="p">(</span><span class="n">ana_apo_1</span><span class="p">,</span> <span class="n">pdb_file</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">logPF_to_deltaG</span><span class="p">(</span><span class="n">ana_obj</span><span class="p">,</span> <span class="n">logPF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param logPF: logP value</span>
<span class="sd">    :return: deltaG in kJ/mol, local unfolding energy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mf">8.3145</span> <span class="o">*</span> <span class="n">ana_obj</span><span class="o">.</span><span class="n">temperature</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">logPF</span> <span class="o">/</span> <span class="mi">1000</span>


<span class="k">def</span> <span class="nf">create_logP_df</span><span class="p">(</span><span class="n">ana_obj</span><span class="p">,</span> <span class="n">index_offset</span><span class="p">):</span>
    <span class="n">df_logPF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">res_i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ana_obj</span><span class="o">.</span><span class="n">results_obj</span><span class="o">.</span><span class="n">protein_sequence</span><span class="p">):</span>
        <span class="n">res_obj_i</span> <span class="o">=</span> <span class="n">ana_obj</span><span class="o">.</span><span class="n">results_obj</span><span class="o">.</span><span class="n">get_residue_by_resindex</span><span class="p">(</span><span class="n">res_i</span><span class="p">)</span>

        <span class="n">avg_logP</span><span class="p">,</span> <span class="n">std_logP</span> <span class="o">=</span> <span class="n">get_res_avg_logP</span><span class="p">(</span><span class="n">res_obj_i</span><span class="p">)</span>
        <span class="c1">#std_logP = get_res_avg_logP_std(res_obj_i)</span>

        <span class="n">df_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;resid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">res_obj_i</span><span class="o">.</span><span class="n">resid</span> <span class="o">-</span> <span class="n">index_offset</span><span class="p">],</span>
                <span class="c1">#&quot;resname&quot;: [res_obj_i.resname],</span>
                <span class="s2">&quot;resname&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">MDAnalysis</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">convert_aa_code</span><span class="p">(</span><span class="n">res_obj_i</span><span class="o">.</span><span class="n">resname</span><span class="p">)],</span>
                <span class="s1">&#39;avg_dG&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">logPF_to_deltaG</span><span class="p">(</span><span class="n">ana_obj</span><span class="p">,</span> <span class="n">avg_logP</span><span class="p">)],</span>
                <span class="s1">&#39;std_dG&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">logPF_to_deltaG</span><span class="p">(</span><span class="n">ana_obj</span><span class="p">,</span> <span class="n">std_logP</span><span class="p">)],</span>
                <span class="s2">&quot;avg_logP&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">avg_logP</span><span class="p">],</span>
                <span class="s2">&quot;std_logP&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">std_logP</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)],</span>
                <span class="s2">&quot;is_nan&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">res_obj_i</span><span class="o">.</span><span class="n">is_nan</span><span class="p">()],</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">res_obj_i</span><span class="o">.</span><span class="n">is_nan</span><span class="p">():</span>
            <span class="n">df_i</span><span class="p">[</span><span class="s2">&quot;single resloved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
            <span class="n">df_i</span><span class="p">[</span><span class="s2">&quot;min_pep logPs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_i</span><span class="p">[</span><span class="s2">&quot;single resloved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">res_obj_i</span><span class="o">.</span><span class="n">mini_pep</span><span class="o">.</span><span class="n">if_single_residue</span><span class="p">()]</span>
            <span class="n">df_i</span><span class="p">[</span><span class="s2">&quot;min_pep logPs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">res_obj_i</span><span class="o">.</span><span class="n">clustering_results_logP</span><span class="p">]</span>

        <span class="n">df_logPF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_logPF</span><span class="p">,</span> <span class="n">df_i</span><span class="p">])</span>

    <span class="n">df_logPF</span> <span class="o">=</span> <span class="n">df_logPF</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_logPF</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">create_logP_df</span><span class="p">(</span><span class="n">ana_apo_1</span><span class="p">,</span> <span class="n">index_offset</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">/logP_APO_</span><span class="si">{</span><span class="n">today_date</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fecth two df and merge</span>
<span class="n">df_apo</span> <span class="o">=</span> <span class="n">create_logP_df</span><span class="p">(</span><span class="n">ana_apo_1</span><span class="p">,</span> <span class="n">index_offset</span><span class="p">)</span>
<span class="n">df_tri</span> <span class="o">=</span> <span class="n">create_logP_df</span><span class="p">(</span><span class="n">ana_tri_1</span><span class="p">,</span> <span class="n">index_offset</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_apo</span><span class="p">,</span> <span class="n">df_tri</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;resid&quot;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;_APO&quot;</span><span class="p">,</span> <span class="s2">&quot;_TRI&quot;</span><span class="p">))</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">results_path</span><span class="si">}</span><span class="s2">/logP_APO_TRI_</span><span class="si">{</span><span class="n">today_date</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="04_check_the_fitting.html" class="btn btn-neutral float-left" title="04_check_the_fitting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, glasgowlab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>